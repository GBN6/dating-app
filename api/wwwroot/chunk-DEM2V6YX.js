import{aa as u,ba as a,ca as h,da as b,ea as m}from"./chunk-OQHUP3JO.js";import{$ as o,Bc as l,T as c,X as r,rc as p,ua as s}from"./chunk-U7UGUVDU.js";var f=class i{http=o(p);API_URL=a.API_URL;_likeIds=s([]);likeIds=this._likeIds.asReadonly();toggleLike$(t){return this.http.post(`${this.API_URL}/likes/${t}`,{}).pipe(c(()=>{this._likeIds().includes(t)?this._likeIds.update(e=>e.filter(n=>n!==t)):this._likeIds.update(e=>[...e,t])}))}getLikes$(t){return this.http.get(`${this.API_URL}/likes`,{params:t})}getLikeIds$(){return this.http.get(`${this.API_URL}/likes/list`).pipe(c(t=>this._likeIds.set(t)))}static \u0275fac=function(e){return new(e||i)};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})};var d=class i{snackBar=o(u);router=o(l);HUBS_URL=a.HUBS_URL;MESSAGE_DURATION=3e3;_onlineUsers=s([]);onlineUsers=this._onlineUsers.asReadonly();hubConnection;createHubConnection(t){this.hubConnection=new m().withUrl(`${this.HUBS_URL}/presence`,{accessTokenFactory:()=>t}).configureLogging(h.None).withAutomaticReconnect().build(),this.hubConnection.start().catch(e=>{console.error("Error starting SignalR hub connection:",e)}),this.hubConnection.on("UserIsOnline",e=>this._onlineUsers.update(n=>[...n,e])),this.hubConnection.on("UserIsOffline",e=>this._onlineUsers.update(n=>n.filter(g=>g!==e))),this.hubConnection.on("GetOnlineUsers",e=>this._onlineUsers.set(e)),this.hubConnection.on("NewMessageReceived",({knownAs:e})=>this.getSnackBar(`${e} has sent you a new message!`))}stopHubConnection(){this.hubConnection?.state===b.Connected&&this.hubConnection.stop().catch(t=>console.error("Error stopping SignalR hub connection:",t))}getSnackBar(t){return this.snackBar.open(t,"X",{duration:this.MESSAGE_DURATION,panelClass:["success"],verticalPosition:"top"})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})};export{f as a,d as b};
