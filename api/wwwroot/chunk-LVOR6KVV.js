import{a as ee}from"./chunk-HJN5DW6W.js";import{a as Y,b as Z}from"./chunk-XICTCNVT.js";import{a as X}from"./chunk-4T4HCHXV.js";import{a as K}from"./chunk-UDI4GLZX.js";import{a as E,b as H}from"./chunk-HHNKQW6O.js";import"./chunk-FEM247ZK.js";import"./chunk-SLUF46T5.js";import{f as h,g as Q,h as W}from"./chunk-6AA6WHQX.js";import{m as L}from"./chunk-XVLLIRVL.js";import"./chunk-P2CIGLQN.js";import{d as q,e as G,g as j,i as A,j as z,p as J}from"./chunk-Y3WRGRHF.js";import"./chunk-OQHUP3JO.js";import{a as V}from"./chunk-QCTHIZDT.js";import{$ as g,Ab as f,Bc as B,C as y,Cb as S,Ea as D,Ga as a,Gb as U,Ib as $,Lb as _,Mb as C,Oa as u,Q as T,Sa as I,T as P,Ua as x,Za as m,cb as N,ga as M,gb as o,ha as v,hb as r,ib as d,ic as k,jc as R,ka as w,mb as O,ob as l,pb as p,t as F}from"./chunk-U7UGUVDU.js";var b=class t extends X{sortOpitons=[{value:"unread",label:"Unread"},{value:"Inbox",label:"Inbox"},{value:"Outbox",label:"Outbox"}];ngOnInit(){super.ngOnInit(),this.filter()}buildForm(){this.form=this.fb.group({Container:this.fb.control("unread")})}onSortChange(n){this.filter()}static \u0275fac=(()=>{let n;return function(i){return(n||(n=w(t)))(i||t)}})();static \u0275cmp=u({type:t,selectors:[["app-messages-filters"]],features:[I],decls:2,vars:2,consts:[[1,"login-form","flex","flex--column","flex--center","gap-1","text-center",3,"ngSubmit","formGroup"],["formControlName","Container","type","select","label","Show messages","placeholder","Choose which messages",1,"margin-bottom-3",3,"valueChange","options"]],template:function(e,i){e&1&&(o(0,"form",0),l("ngSubmit",function(){return i.filter()}),o(1,"app-field-select",1),l("valueChange",function(c){return i.onSortChange(c)}),r()()),e&2&&(m("formGroup",i.form),a(),m("options",i.sortOpitons))},dependencies:[J,j,q,G,A,z,H,K],encapsulation:2,changeDetection:0})};var se=t=>({outbox:t});function re(t,n){if(t&1&&(o(0,"div",5),d(1,"img",6),o(2,"strong",7),f(3),_(4,"titlecase"),r()()),t&2){let e=n.element,i=p();a(),m("src",(i.outbox?e.recipientPhotoUrl:e.senderPhotoUrl)||"/user.png",D),a(2),S(" ",C(4,2,i.outbox?e.recipientUsername:e.senderUsername)," ")}}function ae(t,n){if(t&1&&(f(0),_(1,"timeago")),t&2){let e=n.element;S(" ",C(1,1,e.messageSent)," ")}}function me(t,n){if(t&1){let e=O();o(0,"div",8)(1,"app-button",9),l("click",function(){let s=M(e).element,c=p(2);return v(c.deleteMessage(s.id))}),d(2,"app-icon",10),r(),o(3,"app-button",11),l("click",function(){let s=M(e).element,c=p(),ne=p();return v(ne.goToMessage(c.outbox,s))}),o(4,"p"),f(5,"Check Message"),r()()()}}function le(t,n){if(t&1&&(d(0,"app-messages-filters"),o(1,"app-paginator",1),x(2,re,5,4,"ng-template",2)(3,ae,2,3,"ng-template",3)(4,me,6,0,"ng-template",4),r()),t&2){let e=p();a(),m("request",e.messagesRequest)("isTable",!0)("tableColumns",e.columns)}}var te=class t{messageService=g(ee);paginatorService=g(h);router=g(B);outbox$=this.paginatorService.getStateSlice$("filters").pipe(y(Boolean),F(({Container:n})=>n==="Outbox"));columns=[{name:"content",content:"Message"},{name:"senderUsername",content:"From / To"},{name:"dateRead",content:"Sent / Received"},{name:"actions",content:"Actions"}];get messagesRequest(){return this.messageService.getMessages$.bind(this.messageService)}deleteMessage(n){this.messageService.deleteMessage$(n).pipe(T(()=>this.paginatorService.getStateSlice$("data")),P(e=>{let i=e?.filter(s=>s.id!==n);this.paginatorService.patchState({data:i})})).subscribe()}goToMessage(n,e){let i=n?`/members/${e.recipientUsername}`:`/members/${e.senderUsername}`;this.router.navigate([i],{queryParams:{tab:3}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=u({type:t,selectors:[["app-messages"]],features:[U([h])],decls:3,vars:5,consts:[[1,"messages","padding-3"],["emptyText","No messages",3,"request","isTable","tableColumns"],["appTableCell","","column","senderUsername"],["appTableCell","","column","dateRead"],["appTableCell","","column","actions"],[1,"flex","gap-1","text-center"],["mat-card-xl-image","",3,"src"],[1,"flex--align-self-center"],[1,"flex","gap-1","flex--center"],["design","tertiary",3,"click"],["icon","delete"],[3,"click"]],template:function(e,i){if(e&1&&(o(0,"div",0),x(1,le,5,3),_(2,"async"),r()),e&2){let s;a(),N((s=$(3,se,C(2,1,i.outbox$)))?1:-1,s)}},dependencies:[W,b,L,V,Q,k,R,Z,Y,E],styles:[".messages[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;width:45px}@media (min-width: 1420px){.messages[_ngcontent-%COMP%]{min-width:1000px}}"]})};export{te as MessagesComponent};
